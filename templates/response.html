<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respuesta a la Consulta - Quantum Services</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script>
        function addNewQueryBox() {
            const queryBox = document.createElement('div');
            queryBox.classList.add('response-container');
            queryBox.innerHTML = `
                <h2>Nueva Consulta sobre {{ files | join(', ') }}</h2>
                <form onsubmit="submitNewQuery(event, this)">
                    <label for="query">Escriba su consulta:</label>
                    <textarea name="query" rows="4" cols="50"></textarea>
                    <button type="submit" class="button">Enviar</button>
                    <div class="loading" style="display: none;">
                        <img src="{{ url_for('static', filename='gifs/cargando.gif') }}" alt="Cargando...">
                    </div>
                </form>
                <div class="new-response" style="display: none;"></div>
            `;
            document.getElementById('additional-queries').appendChild(queryBox);
        }

        function submitNewQuery(event, form) {
            event.preventDefault();
            const query = form.querySelector('[name="query"]').value;
            const loading = form.querySelector('.loading');
            const responseContainer = form.nextElementSibling;

            loading.style.display = 'block';

            fetch('{{ url_for("query_additional") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    query: query,
                }),
            })
            .then(response => response.text())
            .then(data => {
                loading.style.display = 'none';
                responseContainer.innerHTML = data;
                responseContainer.style.display = 'block';
            })
            .catch(error => {
                loading.style.display = 'none';
                alert('Error: ' + error.message);
            });
        }
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="container navbar-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='logos/Q.png') }}" alt="Quantum Services Logo">
            </div>
            <div>
                <a href="{{ url_for('index') }}">Inicio</a>
                <a href="{{ url_for('logout') }}">Cerrar sesi√≥n</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="response-container">
            <h2>Respuesta a la Nueva Consulta</h2>
            <p><strong>Consulta:</strong> {{ query }}</p>
            <p class="response-text"><strong>Respuesta:</strong> {{ response|safe }}</p>
            <div class="download-container">
                <p>Click para descargar en PDF las consultas:</p>
                <a href="{{ url_for('download_pdf') }}">
                    <img src="{{ url_for('static', filename='logos/descarga.png') }}" alt="Descargar" style="width: 32px; height: 32px;">
                </a>
            </div>
        </div>
        <div id="additional-queries"></div>
        <div class="button-container">
            <a class="button" href="{{ url_for('index') }}">Hacer otra consulta</a>
            <button class="button" onclick="addNewQueryBox()">Hacer otra consulta de {{ files | join(', ') }}</button>
        </div>
    </div>
</body>
</html>
